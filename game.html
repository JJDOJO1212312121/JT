<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>เกม MY HEART IS YO !</title>
<style>
body {
margin: 0;
background: black;
overflow: hidden;
touch-action: none;
}
canvas {
display: block;
margin: auto;
background: black;
}
/* ปุ่มควบคุม */
.control-btn {
position: absolute;
bottom: 80px; /* ปรับสูงขึ้น */
width: 80px;
height: 80px;
background: rgba(255,255,255,0.3);
border-radius: 50%;
font-size: 40px;
color: white;
border: none;
}
#leftBtn { left: 20px; }
#rightBtn { right: 20px; }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>
<button id="leftBtn" class="control-btn">←</button>
<button id="rightBtn" class="control-btn">→</button>

<!-- เพลงและเสียง -->
<audio id="bgm" loop>
<source src="bgm.mp3" type="audio/mpeg">
</audio>
<audio id="gameoverSound">
<source src="gameover.mp3" type="audio/mpeg">
</audio>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
let W = window.innerWidth;
let H = window.innerHeight;
canvas.width = W;
canvas.height = H;

// โหลดรูปหัวใจและหน้าโยลองดี
const heartImg = new Image();
heartImg.src = "heart.png";
const enemyImg = new Image();
enemyImg.src = "yolongdee.png";

// เพลงและเสียง
const bgm = document.getElementById("bgm");
const gameoverSound = document.getElementById("gameoverSound");

// ตัวละครผู้เล่น
const player = { x: W/2-25, y: H-100, w: 50, h: 50, speed: 6 };

// ศัตรู
let enemies = [];
let enemySpeed = 3;

// ควบคุม
let moveLeft = false;
let moveRight = false;
let running = false;

// นับถอยหลัง
let countdown = 5;
let countdownActive = true;
let countdownLast = 0;

// กติกา
const ruleText = "กติกา: ใช้ปุ่ม ← → หรือปัดซ้าย/ขวา หรือจิ้มสไลด์หัวใจบนจอ เพื่อหลบหน้าโยลองดี";

// ปุ่มซ้ายขวา
document.getElementById("leftBtn").addEventListener("touchstart", () => moveLeft = true);
document.getElementById("leftBtn").addEventListener("touchend", () => moveLeft = false);
document.getElementById("rightBtn").addEventListener("touchstart", () => moveRight = true);
document.getElementById("rightBtn").addEventListener("touchend", () => moveRight = false);

// ควบคุมคีย์บอร์ด
document.addEventListener("keydown", e => {
if (e.key === "ArrowLeft") moveLeft = true;
if (e.key === "ArrowRight") moveRight = true;
});
document.addEventListener("keyup", e => {
if (e.key === "ArrowLeft") moveLeft = false;
if (e.key === "ArrowRight") moveRight = false;
});

// สไลด์บนจอ
let touchStartX = null;
canvas.addEventListener("touchstart", e => {
touchStartX = e.touches[0].clientX;
});
canvas.addEventListener("touchmove", e => {
if (touchStartX !== null) {
let deltaX = e.touches[0].clientX - touchStartX;
player.x += deltaX * 0.1;
touchStartX = e.touches[0].clientX;
}
});
canvas.addEventListener("touchend", () => {
touchStartX = null;
});

// เริ่มเพลง
function startMusic() {
bgm.play().catch(()=>{});
}

// สร้างศัตรู
function spawnEnemy() {
enemies.push({ x: Math.random() * (W-50), y: -50, w: 50, h: 50 });
}

// อัปเดตเกม
function update(dt) {
// ขยับผู้เล่น
if (moveLeft) player.x -= player.speed;
if (moveRight) player.x += player.speed;
player.x = Math.max(0, Math.min(W - player.w, player.x));

// ขยับศัตรู
for (let e of enemies) {
e.y += enemySpeed;
if (e.y > H) {
e.y = -50;
e.x = Math.random() * (W-50);
}
// ชนผู้เล่น
if (e.x < player.x + player.w &&
e.x + e.w > player.x &&
e.y < player.y + player.h &&
e.y + e.h > player.y) {
running = false;
gameoverSound.play();
}
}
}

// วาดเกม
function draw() {
// กติกา
ctx.fillStyle = "yellow";
ctx.font = "20px Arial";
ctx.textAlign = "center";
ctx.fillText(ruleText, W/2, 30);

// ผู้เล่น
ctx.drawImage(heartImg, player.x, player.y, player.w, player.h);

// ศัตรู
for (let e of enemies) {
ctx.drawImage(enemyImg, e.x, e.y, e.w, e.h);
}
}

// ลูปหลัก
function loop(timestamp) {
if (!this.last) this.last = timestamp;
let dt = timestamp - this.last;
this.last = timestamp;

ctx.clearRect(0, 0, W, H);

if (countdownActive) {
countdownLast += dt;
if (countdownLast >= 1000) {
countdown--;
countdownLast = 0;
}

// กติกา
ctx.fillStyle = "yellow";
ctx.font = "20px Arial";
ctx.textAlign = "center";
ctx.fillText(ruleText, W/2, 30);

// ตัวเลขนับถอยหลัง
ctx.fillStyle = "white";
ctx.font = "80px Arial";
ctx.textAlign = "center";
ctx.fillText(countdown > 0 ? countdown : "เริ่ม!", W/2, H/2);

if (countdown <= 0) {
countdownActive = false;
running = true;
startMusic();
setInterval(spawnEnemy, 1000);
}
} else {
if (running) update(dt);
draw();
}

requestAnimationFrame(loop.bind(this));
}
requestAnimationFrame(loop.bind({}));
</script>

</body>
</html>

